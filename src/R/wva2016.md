World Health Organization (WHO) 2016 Verbal Autopsy (VA) Codes
================
Richard Wen <rrwen.dev@gmail.com>Bryan Gascon
<bryan.gascon@mail.utoronto.ca>

WHO VA 2016 codes from/to ICD mapping.

## Libraries

``` r
library(tidyverse)
```

    ## ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──
    ## ✔ ggplot2 3.3.6      ✔ purrr   0.3.4 
    ## ✔ tibble  3.1.8      ✔ dplyr   1.0.10
    ## ✔ tidyr   1.2.1      ✔ stringr 1.5.0 
    ## ✔ readr   2.1.2      ✔ forcats 0.5.2 
    ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ## ✖ dplyr::filter() masks stats::filter()
    ## ✖ dplyr::lag()    masks stats::lag()

``` r
library(cghrCodes)
```

## Read Data

Read data from `../data` folder:

- `WVAtoICD_map1-5.csv`: edited raw WHO VA mappings compiled from the
  WHO VA 2016 v1.5 PDF manual by Cheryl Chin

``` r
wva2016raw <- read_csv(
  "../data/WVAtoICD_map1-5_RW.csv",
  show_col_types=FALSE,
  col_types = list(
    code = col_character(),
    group = col_character()
  )
)
wva2016raw
```

    ## # A tibble: 85 × 11
    ##    kind  kind_depth code_orig code  group_…¹ group group…² group…³ title icd10…⁴
    ##    <chr>      <dbl> <chr>     <chr> <chr>    <chr> <chr>   <chr>   <chr> <chr>  
    ##  1 group          1 <NA>      <NA>  VAs-01   1     VAs-01… Infect… <NA>  <NA>   
    ##  2 code           2 VAs-01.01 1.01  VAs-01   1     VAs-01… Infect… Seps… A41    
    ##  3 code           2 VAs-01.02 1.02  VAs-01   1     VAs-01… Infect… Acut… J22    
    ##  4 code           2 VAs-01.02 1.02  VAs-01   1     VAs-01… Infect… Acut… J18    
    ##  5 code           2 VAs-01.03 1.03  VAs-01   1     VAs-01… Infect… HIV/… B24    
    ##  6 code           2 VAs-01.04 1.04  VAs-01   1     VAs-01… Infect… Diar… A09    
    ##  7 code           2 VAs-01.05 1.05  VAs-01   1     VAs-01… Infect… Mala… B54    
    ##  8 code           2 VAs-01.06 1.06  VAs-01   1     VAs-01… Infect… Meas… B05    
    ##  9 code           2 VAs-01.07 1.07  VAs-01   1     VAs-01… Infect… Meni… G03    
    ## 10 code           2 VAs-01.07 1.07  VAs-01   1     VAs-01… Infect… Meni… G04    
    ## # … with 75 more rows, 1 more variable: icd10_from_range <chr>, and abbreviated
    ## #   variable names ¹​group_orig, ²​group_title_orig, ³​group_title, ⁴​icd10_to

## Preprocess

Preprocess the data by lower-casing and renaming columns.

``` r
wva2016 <- wva2016raw %>%
  rename_all(tolower) %>%
  relocate(
    kind,
    kind_depth,
    group,
    code,
    group_title,
    title,
    icd10_to,
    icd10_from_range,
    group_orig,
    code_orig,
    group_title_orig
  )
wva2016
```

    ## # A tibble: 85 × 11
    ##    kind  kind_depth group code  group_ti…¹ title icd10…² icd10…³ group…⁴ code_…⁵
    ##    <chr>      <dbl> <chr> <chr> <chr>      <chr> <chr>   <chr>   <chr>   <chr>  
    ##  1 group          1 1     <NA>  Infectiou… <NA>  <NA>    A40-A4… VAs-01  <NA>   
    ##  2 code           2 1     1.01  Infectiou… Seps… A41     A40-A41 VAs-01  VAs-01…
    ##  3 code           2 1     1.02  Infectiou… Acut… J22     J00-J22 VAs-01  VAs-01…
    ##  4 code           2 1     1.02  Infectiou… Acut… J18     J00-J22 VAs-01  VAs-01…
    ##  5 code           2 1     1.03  Infectiou… HIV/… B24     B20-B24 VAs-01  VAs-01…
    ##  6 code           2 1     1.04  Infectiou… Diar… A09     A00-A09 VAs-01  VAs-01…
    ##  7 code           2 1     1.05  Infectiou… Mala… B54     B50-B54 VAs-01  VAs-01…
    ##  8 code           2 1     1.06  Infectiou… Meas… B05     B05     VAs-01  VAs-01…
    ##  9 code           2 1     1.07  Infectiou… Meni… G03     A39,G0… VAs-01  VAs-01…
    ## 10 code           2 1     1.07  Infectiou… Meni… G04     A39,G0… VAs-01  VAs-01…
    ## # … with 75 more rows, 1 more variable: group_title_orig <chr>, and abbreviated
    ## #   variable names ¹​group_title, ²​icd10_to, ³​icd10_from_range, ⁴​group_orig,
    ## #   ⁵​code_orig

## Collapse ICD-10 Ranges

Collapse the individual ICD-10 ranges to add a short form column with
consecutive ranges defined by `-`:

``` r
wva2016$icd10_from_range_short <- apply(wva2016, 1, function(x) paste(collapseICD10(x["icd10_from_range"]), collapse=","))
wva2016
```

    ## # A tibble: 85 × 12
    ##    kind  kind_depth group code  group_ti…¹ title icd10…² icd10…³ group…⁴ code_…⁵
    ##    <chr>      <dbl> <chr> <chr> <chr>      <chr> <chr>   <chr>   <chr>   <chr>  
    ##  1 group          1 1     <NA>  Infectiou… <NA>  <NA>    A40-A4… VAs-01  <NA>   
    ##  2 code           2 1     1.01  Infectiou… Seps… A41     A40-A41 VAs-01  VAs-01…
    ##  3 code           2 1     1.02  Infectiou… Acut… J22     J00-J22 VAs-01  VAs-01…
    ##  4 code           2 1     1.02  Infectiou… Acut… J18     J00-J22 VAs-01  VAs-01…
    ##  5 code           2 1     1.03  Infectiou… HIV/… B24     B20-B24 VAs-01  VAs-01…
    ##  6 code           2 1     1.04  Infectiou… Diar… A09     A00-A09 VAs-01  VAs-01…
    ##  7 code           2 1     1.05  Infectiou… Mala… B54     B50-B54 VAs-01  VAs-01…
    ##  8 code           2 1     1.06  Infectiou… Meas… B05     B05     VAs-01  VAs-01…
    ##  9 code           2 1     1.07  Infectiou… Meni… G03     A39,G0… VAs-01  VAs-01…
    ## 10 code           2 1     1.07  Infectiou… Meni… G04     A39,G0… VAs-01  VAs-01…
    ## # … with 75 more rows, 2 more variables: group_title_orig <chr>,
    ## #   icd10_from_range_short <chr>, and abbreviated variable names ¹​group_title,
    ## #   ²​icd10_to, ³​icd10_from_range, ⁴​group_orig, ⁵​code_orig

## Expand ICD-10 Ranges

Expands the ICD-10 codes from the `icd_range_codes_2016` column to
create an ICD-10 code for each WHO VA code:

``` r
# Filter out codes only
icd10towva2016 <- wva2016 %>%
  filter(kind == "code") %>%
  select(
    group,
    code,
    group_title,
    title,
    icd10_from_range_short
  ) %>%
  rename(
    wva2016_group = group,
    wva2016_code = code,
    wva2016_group_title = group_title,
    wva2016_title = title,
    icd10_range = icd10_from_range_short
  )

# Expand icd codes
icd10towva2016 <- expandICD10Data(
  icd10towva2016,
  icd10Column="icd10_range",
  expandColumn="icd10_code"
)
as_tibble(icd10towva2016)
```

    ## # A tibble: 2,384 × 6
    ##    wva2016_group wva2016_code wva2016_group_title        wva20…¹ icd10…² icd10…³
    ##    <chr>         <chr>        <chr>                      <chr>   <chr>   <chr>  
    ##  1 1             1.04         Infectious and parasitic … Diarrh… A00-09  A00    
    ##  2 1             1.04         Infectious and parasitic … Diarrh… A00-09  A01    
    ##  3 1             1.04         Infectious and parasitic … Diarrh… A00-09  A02    
    ##  4 1             1.04         Infectious and parasitic … Diarrh… A00-09  A03    
    ##  5 1             1.04         Infectious and parasitic … Diarrh… A00-09  A04    
    ##  6 1             1.04         Infectious and parasitic … Diarrh… A00-09  A05    
    ##  7 1             1.04         Infectious and parasitic … Diarrh… A00-09  A06    
    ##  8 1             1.04         Infectious and parasitic … Diarrh… A00-09  A07    
    ##  9 1             1.04         Infectious and parasitic … Diarrh… A00-09  A08    
    ## 10 1             1.04         Infectious and parasitic … Diarrh… A00-09  A09    
    ## # … with 2,374 more rows, and abbreviated variable names ¹​wva2016_title,
    ## #   ²​icd10_range, ³​icd10_code

## Filter for WVA Codes Only

Filter for codes to create WVA 2016 to ICD 10 mappings, and also rename
columns.

``` r
wva2016toicd10 <- wva2016 %>% filter(kind == "code") %>%
  select(
    group,
    code,
    group_title,
    title,
    icd10_to
  ) %>%
  rename(
    wva2016_group = group,
    wva2016_code = code,
    wva2016_group_title = group_title,
    wva2016_title = title,
    icd10_code = icd10_to
  )
wva2016toicd10
```

    ## # A tibble: 71 × 5
    ##    wva2016_group wva2016_code wva2016_group_title               wva201…¹ icd10…²
    ##    <chr>         <chr>        <chr>                             <chr>    <chr>  
    ##  1 1             1.01         Infectious and parasitic diseases Sepsis   A41    
    ##  2 1             1.02         Infectious and parasitic diseases Acute r… J22    
    ##  3 1             1.02         Infectious and parasitic diseases Acute r… J18    
    ##  4 1             1.03         Infectious and parasitic diseases HIV/AID… B24    
    ##  5 1             1.04         Infectious and parasitic diseases Diarrhe… A09    
    ##  6 1             1.05         Infectious and parasitic diseases Malaria  B54    
    ##  7 1             1.06         Infectious and parasitic diseases Measles  B05    
    ##  8 1             1.07         Infectious and parasitic diseases Meningi… G03    
    ##  9 1             1.07         Infectious and parasitic diseases Meningi… G04    
    ## 10 1             1.08         Infectious and parasitic diseases Tetanus… A35    
    ## # … with 61 more rows, and abbreviated variable names ¹​wva2016_title,
    ## #   ²​icd10_code

## Save Data

Writes the collapsed and expanded WHO VA 2016 agreement codes to the
`../data` folder.

``` r
write_csv(wva2016, "../data/wva2016_raw.csv", na="")
write_csv(icd10towva2016, "../data/icd10towva2016_raw.csv", na="")
write_csv(wva2016toicd10, "../data/wva2016toicd10.csv", na="")
```
